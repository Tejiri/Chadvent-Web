<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link
      rel="stylesheet"
      href="bootstrap-5.0.0-beta2-dist/css/bootstrap.css"
    />
    <link rel="stylesheet" href="styles/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap5.min.css"
    />
  </head>

  <nav
    class="navbar navbar-expand-lg navbar-light fixed-top bg-light"
    style="background-color: white"
  >
    <div class="container-fluid" style="width: 100%">
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarTogglerDemo01"
        aria-controls="navbarTogglerDemo01"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
        <a class="navbar-brand" href="#"
          ><img src="images/chadvent-logo.png" alt="" srcset="" width="50"
        /></a>
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a
              class="nav-link active"
              aria-current="page"
              href="admin"
              style="font-weight: bold"
              >Admin Dashboard</a
            >
          </li>

          <li class="nav-item">
            <a
              class="nav-link active"
              aria-current="page"
              href="logout"
              style="font-weight: bold"
              >Logout</a
            >
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <body>
    <div style="height: 100px"></div>
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item" role="presentation">
        <button
          class="nav-link active"
          id="pills-home-tab"
          data-bs-toggle="pill"
          data-bs-target="#pills-home"
          type="button"
          role="tab"
          aria-controls="pills-home"
          aria-selected="true"
        >
          Update member details
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="pills-profile-tab"
          data-bs-toggle="pill"
          data-bs-target="#pills-profile"
          type="button"
          role="tab"
          aria-controls="pills-profile"
          aria-selected="false"
        >
          Credit Account
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="pills-contact-tab"
          data-bs-toggle="pill"
          data-bs-target="#pills-contact"
          type="button"
          role="tab"
          aria-controls="pills-contact"
          aria-selected="false"
        >
          Debit Account
        </button>
      </li>
    </ul>
    <div class="tab-content" id="pills-tabContent">
      <div
        class="tab-pane fade show active"
        id="pills-home"
        role="tabpanel"
        aria-labelledby="pills-home-tab"
      >
        <%-include('editmember/updatememberdetails.ejs') -%>
      </div>
      <div
        class="tab-pane fade"
        id="pills-profile"
        role="tabpanel"
        aria-labelledby="pills-profile-tab"
      >
        <%-include('editmember/creditmember.ejs') -%>
      </div>
      <div
        class="tab-pane fade"
        id="pills-contact"
        role="tabpanel"
        aria-labelledby="pills-contact-tab"
      >
        <%-include('editmember/debitmember.ejs') -%>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="bootstrap-5.0.0-beta2-dist/js/bootstrap.bundle.js"></script>

    <script>
      function sweetSuccess(message) {
        return Swal.fire({
          position: "center",
          icon: "success",
          title: message,
          showConfirmButton: false,
          timer: 3000,
        });
      }

      function sweetFailure(message) {
        return Swal.fire({
          position: "center",
          icon: "error",
          title: message,
          showConfirmButton: false,
          timer: 3000,
        });
      }

      $("#updateform").submit(function (e) {
        e.preventDefault();
        $.ajax({
          url: "http://localhost:3000/editmember",
          type: "POST",
          data: {
            username: $("#username").val(),
            title: $("#title").val(),
            firstname: $("#firstname").val(),
            lastname: $("#lastname").val(),
            middlename: $("#middlename").val(),
            position: $("#position").val(),
            membershipstatus: $("#membershipstatus").val(),
            lasttransaction: $("#lasttransaction").val(),
            loanapplicationstatus: $("#loanapplicationstatus").val(),
            phonenumber: $("#phonenumber").val(),
            email: $("#email").val(),
            address: $("#address").val(),
            gender: $("#gender").val(),
            occupation: $("#occupation").val(),
            nextofkin: $("#nextofkin").val(),
            nextofkinaddress: $("#nextofkinaddress").val(),
            updatebutton: $("#updatemember").val(),
          },
          success: function (data) {
            console.log(data);
            sweetSuccess("Member account updated");
          },

          fail: function (xhr, textStatus, errorThrown) {
            sweetFailure();
          },
        });
      });

      $("#deletemember").click(function (e) {
        Swal.fire({
          title: "Are you sure you want to delete this member?",
          showDenyButton: true,
          confirmButtonText: `Yes`,
          denyButtonText: `No`,
        }).then((result) => {
          /* Read more about isConfirmed, isDenied below */
          if (result.isConfirmed) {
            $.ajax({
              url: "http://localhost:3000/editmember",
              type: "Delete",
              data: {
                username: $("#username").val(),
              },
              success: function (data) {
                console.log(data);
                if (data.message == "deleted successfully") {
                  Swal.fire("Member Deleted", "", "success");

                  location.replace("http://localhost:3000/admin");
                }
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure();
              },
            });
          } else if (result.isDenied) {
            Swal.fire("This member has not been deleted", "", "info");
          }
        });
      });

      $("#creditform").submit(function (e) {
        e.preventDefault();
        if ($("#creditselect").val() == "Open this select menu") {
          sweetFailure("Please select an account to be credited");
        } else {
          $.ajax({
            url: "http://localhost:3000/editmember",
            type: "POST",
            data: {
              transactiontype: "credit",
              username: $("#username").val(),
              creditselect: $("#creditselect").val(),
              creditamount: $("#creditamount").val(),
              creditdescription: $("#creditdescription").val(),
              creditdate: $("#creditdate").val(),
              updatebutton: $("#creditaccount").val(),
            },
            success: function (data) {
              console.log(data);
              if (data.ok == 1) {
                sweetSuccess(
                  "Member has been credited with " + $("#creditamount").val()
                );
              }
            },

            fail: function (xhr, textStatus, errorThrown) {
              sweetFailure();
            },
          });
        }
      });


      $("#debitform").submit(function (e) {
        e.preventDefault();
        if ($("#debitselect").val() == "Open this select menu") {
          sweetFailure("Please select an account to be debited");
        } else {
          $.ajax({
            url: "http://localhost:3000/editmember",
            type: "POST",
            data: {
              transactiontype: "debit",
              username: $("#username").val(),
              debitselect: $("#debitselect").val(),
              debitamount: $("#debitamount").val(),
              debitdescription: $("#debitdescription").val(),
              debitdate: $("#debitdate").val(),
              updatebutton: $("#debitaccount").val(),
            },
            success: function (data) {
              console.log(data);
              if (data.ok == 1) {
                sweetSuccess(
                  "Member has been debited with " + $("#debitamount").val()
                );
              }
            },

            fail: function (xhr, textStatus, errorThrown) {
              sweetFailure();
            },
          });
        }
      });
    </script>
  </body>
</html>
