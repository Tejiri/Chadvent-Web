<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Member</title>

    <link
      rel="stylesheet"
      href="bootstrap-5.0.0-beta2-dist/css/bootstrap.css"
    />
    <link rel="stylesheet" href="styles/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap5.min.css"
    />
    <link rel="icon" href="images/chadvent-logo.png" />

    <link
      rel="stylesheet"
      href="datatables/DataTables-1.10.23/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="datatables/Buttons-1.6.5/css/buttons.dataTables.min.css"
    />

    <style>
      table.blueTable {
        border: 1px solid #1c6ea4;
        background-color: #eeeeee;
        width: 100%;
        text-align: left;
        border-collapse: collapse;
      }
      table.blueTable td,
      table.blueTable th {
        border: 1px solid #aaaaaa;
        padding: 3px 2px;
      }
      table.blueTable tbody td {
        font-size: 13px;
      }
      table.blueTable tr:nth-child(even) {
        background: #d0e4f5;
      }
      table.blueTable thead {
        background: #1c6ea4;
        background: -moz-linear-gradient(
          top,
          #5592bb 0%,
          #327cad 66%,
          #1c6ea4 100%
        );
        background: -webkit-linear-gradient(
          top,
          #5592bb 0%,
          #327cad 66%,
          #1c6ea4 100%
        );
        background: linear-gradient(
          to bottom,
          #5592bb 0%,
          #327cad 66%,
          #1c6ea4 100%
        );
        border-bottom: 2px solid #444444;
      }
      table.blueTable thead th {
        font-size: 15px;
        font-weight: bold;
        color: #ffffff;
        border-left: 2px solid #d0e4f5;
      }
      table.blueTable thead th:first-child {
        border-left: none;
      }

      table.blueTable tfoot {
        font-size: 14px;
        font-weight: bold;
        color: #ffffff;
        background: #d0e4f5;
        background: -moz-linear-gradient(
          top,
          #dcebf7 0%,
          #d4e6f6 66%,
          #d0e4f5 100%
        );
        background: -webkit-linear-gradient(
          top,
          #dcebf7 0%,
          #d4e6f6 66%,
          #d0e4f5 100%
        );
        background: linear-gradient(
          to bottom,
          #dcebf7 0%,
          #d4e6f6 66%,
          #d0e4f5 100%
        );
        border-top: 2px solid #444444;
      }
      table.blueTable tfoot td {
        font-size: 14px;
      }
      table.blueTable tfoot .links {
        text-align: right;
      }
      table.blueTable tfoot .links a {
        display: inline-block;
        background: #1c6ea4;
        color: #ffffff;
        padding: 2px 8px;
        border-radius: 5px;
      }
    </style>
  </head>

  <nav
    class="navbar navbar-expand-lg navbar-light fixed-top bg-light"
    style="background-color: white"
  >
    <div class="container-fluid" style="width: 100%">
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarTogglerDemo01"
        aria-controls="navbarTogglerDemo01"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
        <a class="navbar-brand" href="#"
          ><img src="images/chadvent-logo.png" alt="" srcset="" width="50"
        /></a>
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a
              class="nav-link active"
              aria-current="page"
              href="admin"
              style="font-weight: bold"
              >Admin Dashboard</a
            >
          </li>

          <li class="nav-item">
            <a
              class="nav-link active"
              aria-current="page"
              href="newssection"
              style="font-weight: bold"
              >News Section</a
            >
          </li>

          <li class="nav-item">
            <a
              class="nav-link active"
              aria-current="page"
              href="logout"
              style="font-weight: bold"
              >Logout</a
            >
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <body>
    <div style="height: 100px"></div>
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item" role="presentation">
        <button
          class="nav-link active"
          id="pills-home-tab"
          data-bs-toggle="pill"
          data-bs-target="#pills-home"
          type="button"
          role="tab"
          aria-controls="pills-home"
          aria-selected="true"
        >
          Update member details
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="pills-profile-tab"
          data-bs-toggle="pill"
          data-bs-target="#pills-profile"
          type="button"
          role="tab"
          aria-controls="pills-profile"
          aria-selected="false"
        >
          Credit Account
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="pills-contact-tab"
          data-bs-toggle="pill"
          data-bs-target="#pills-contact"
          type="button"
          role="tab"
          aria-controls="pills-contact"
          aria-selected="false"
        >
          Debit Account
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="accountstatementstab"
          data-bs-toggle="pill"
          data-bs-target="#accountstatements"
          type="button"
          role="tab"
          aria-controls="pills-contact"
          aria-selected="false"
        >
          <%=firstname%> <%=lastname%>'s Account Statements
        </button>
      </li>
    </ul>
    <div class="tab-content" id="pills-tabContent">
      <div
        class="tab-pane fade show active"
        id="pills-home"
        role="tabpanel"
        aria-labelledby="pills-home-tab"
      >
        <%-include('editmember/updatememberdetails.ejs') -%>
      </div>
      <div
        class="tab-pane fade"
        id="pills-profile"
        role="tabpanel"
        aria-labelledby="pills-profile-tab"
      >
        <%-include('editmember/creditmember.ejs') -%>
      </div>
      <div
        class="tab-pane fade"
        id="pills-contact"
        role="tabpanel"
        aria-labelledby="pills-contact-tab"
      >
        <%-include('editmember/debitmember.ejs') -%>
      </div>
      <div
        class="tab-pane fade"
        id="accountstatements"
        role="tabpanel"
        aria-labelledby="pills-contact-tab"
      >
        <%-include('editmember/adminaccountstatement.ejs') -%>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="bootstrap-5.0.0-beta2-dist/js/bootstrap.bundle.js"></script>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="datatables/jquery.js"></script>
    <script src="datatables/DataTables-1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="datatables/Buttons-1.6.5/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="datatables/Buttons-1.6.5/js/buttons.html5.min.js"></script>
    <script src="datatables/Buttons-1.6.5/js/buttons.print.min.js"></script>

    <script>
      function sweetSuccess(message) {
        return Swal.fire({
          position: "center",
          icon: "success",
          title: message,
          showConfirmButton: false,
          timer: 3000,
        });
      }

      function sweetFailure(message) {
        return Swal.fire({
          position: "center",
          icon: "error",
          title: message,
          showConfirmButton: false,
          timer: 3000,
        });
      }

      $("#updateform").submit(function (e) {
        e.preventDefault();
        $.ajax({
          //https://chadventmpcs.herokuapp.com/editmember
          //http://localhost:3000/editmember?username=084
          url: "https://chadventmpcs.herokuapp.com/editmember",
          type: "POST",
          data: {
            username: $("#username").val(),
            title: $("#title").val(),
            firstname: $("#firstname").val(),
            lastname: $("#lastname").val(),
            middlename: $("#middlename").val(),
            position: $("#position").val(),
            membershipstatus: $("#membershipstatus").val(),
            loanapplicationstatus: $("#loanapplicationstatus").val(),
            phonenumber: $("#phonenumber").val(),
            email: $("#email").val(),
            address: $("#address").val(),
            gender: $("#gender").val(),
            occupation: $("#occupation").val(),
            nextofkin: $("#nextofkin").val(),
            nextofkinaddress: $("#nextofkinaddress").val(),
            bank: $("#bank").val(),
            accountnumber: $("#accountnumber").val(),
            updatebutton: $("#updatemember").val(),
          },
          success: function (data) {
            console.log(data);
            sweetSuccess("Member account updated");
            setTimeout(function () {
              location.reload(true);
            }, 2000);
          },

          fail: function (xhr, textStatus, errorThrown) {
            sweetFailure();
          },
        });
      });

      $("#deletemember").click(function (e) {
        Swal.fire({
          title: "Are you sure you want to delete this member?",
          showDenyButton: true,
          confirmButtonText: `Yes`,
          denyButtonText: `No`,
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              url: "https://chadventmpcs.herokuapp.com/editmember",
              type: "Delete",
              data: {
                username: $("#username").val(),
              },
              success: function (data) {
                console.log(data);
                if (data.message == "deleted successfully") {
                  Swal.fire("Member Deleted", "", "success");

                  location.replace("https://chadventmpcs.herokuapp.com/admin");
                }
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure();
              },
            });
          } else if (result.isDenied) {
            Swal.fire("This member has not been deleted", "", "info");
          }
        });
      });

      $("#creditform").submit(function (e) {
        e.preventDefault();
        if ($("#creditselect").val() == "Open this select menu") {
          sweetFailure("Please select an account to be credited");
        } else {
          $.ajax({
            url: "https://chadventmpcs.herokuapp.com/editmember",
            type: "POST",
            data: {
              transactiontype: "credit",
              username: $("#username").val(),
              creditselect: $("#creditselect").val(),
              creditamount: $("#creditamount").val(),
              creditdescription: $("#creditdescription").val(),
              creditdate: $("#creditdate").val(),
              updatebutton: $("#creditaccount").val(),
            },
            success: function (data) {
              console.log(data);
              if (data.ok == 1) {
                sweetSuccess(
                  "Member has been credited with " + $("#creditamount").val()
                );
                setTimeout(function () {
                  location.reload(true);
                }, 2000);
              }
            },

            fail: function (xhr, textStatus, errorThrown) {
              sweetFailure();
            },
          });
        }
      });

      $("#debitform").submit(function (e) {
        e.preventDefault();
        if ($("#debitselect").val() == "Open this select menu") {
          sweetFailure("Please select an account to be debited");
        } else {
          $.ajax({
            url: "https://chadventmpcs.herokuapp.com/editmember",
            type: "POST",
            data: {
              transactiontype: "debit",
              username: $("#username").val(),
              debitselect: $("#debitselect").val(),
              debitamount: $("#debitamount").val(),
              debitdescription: $("#debitdescription").val(),
              debitdate: $("#debitdate").val(),
              updatebutton: $("#debitaccount").val(),
            },
            success: function (data) {
              console.log(data);
              if (data.ok == 1) {
                sweetSuccess(
                  "Member has been debited with " + $("#debitamount").val()
                );
                setTimeout(function () {
                  location.reload(true);
                }, 2000);
              }
            },

            fail: function (xhr, textStatus, errorThrown) {
              sweetFailure();
            },
          });
        }
      });

      document.querySelectorAll(".deletetransactionbutton").forEach((item) => {
        item.addEventListener("click", (event) => {
          $("#deletetransaction").submit(function (e) {
            e.preventDefault();

            $.ajax({
              url: "https://chadventmpcs.herokuapp.com/editmember",
              type: "POST",
              data: {
                updatebutton: event.target.value,
              },
              success: function (data) {
                console.log(data);
                if (data.ok == 1) {
                  sweetSuccess(
                    "Transaction has been deleted" + $("#debitamount").val()
                  );
                  setTimeout(function () {
                    location.reload(true);
                  }, 2000);
                }
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure();
              },
            });
          });
        });
      });

      document.querySelectorAll(".deletetransactionbutton2").forEach((item) => {
        item.addEventListener("click", (event) => {
          $("#deletetransaction2").submit(function (e) {
            e.preventDefault();

            $.ajax({
              url: "https://chadventmpcs.herokuapp.com/editmember",
              type: "POST",
              data: {
                updatebutton: event.target.value,
              },
              success: function (data) {
                console.log(data);
                if (data.ok == 1) {
                  sweetSuccess(
                    "Transaction has been deleted" + $("#debitamount").val()
                  );
                  setTimeout(function () {
                    location.reload(true);
                  }, 2000);
                }
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure();
              },
            });
          });
        });
      });

      document.querySelectorAll(".deletetransactionbutton3").forEach((item) => {
        item.addEventListener("click", (event) => {
          $("#deletetransaction3").submit(function (e) {
            e.preventDefault();

            $.ajax({
              url: "https://chadventmpcs.herokuapp.com/editmember",
              type: "POST",
              data: {
                updatebutton: event.target.value,
              },
              success: function (data) {
                console.log(data);
                if (data.ok == 1) {
                  sweetSuccess(
                    "Transaction has been deleted" + $("#debitamount").val()
                  );
                  setTimeout(function () {
                    location.reload(true);
                  }, 2000);
                }
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure();
              },
            });
          });
        });
      });

      document.querySelectorAll(".deletetransactionbutton4").forEach((item) => {
        item.addEventListener("click", (event) => {
          $("#deletetransaction4").submit(function (e) {
            e.preventDefault();

            $.ajax({
              url: "https://chadventmpcs.herokuapp.com/editmember",
              type: "POST",
              data: {
                updatebutton: event.target.value,
              },
              success: function (data) {
                console.log(data);
                if (data.ok == 1) {
                  sweetSuccess(
                    "Transaction has been deleted" + $("#debitamount").val()
                  );
                  setTimeout(function () {
                    location.reload(true);
                  }, 2000);
                }
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure();
              },
            });
          });
        });
      });

      document.querySelectorAll(".deletetransactionbutton5").forEach((item) => {
        item.addEventListener("click", (event) => {
          $("#deletetransaction5").submit(function (e) {
            e.preventDefault();

            $.ajax({
              url: "https://chadventmpcs.herokuapp.com/editmember",
              type: "POST",
              data: {
                updatebutton: event.target.value,
              },
              success: function (data) {
                console.log(data);
                if (data.ok == 1) {
                  sweetSuccess(
                    "Transaction has been deleted" + $("#debitamount").val()
                  );
                  setTimeout(function () {
                    location.reload(true);
                  }, 2000);
                }
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure();
              },
            });
          });
        });
      });

      $(document).ready(function () {
        $("#loanTable").DataTable({
          info: false,
          responsive: true,
          dom: "lfrtiBp",
          buttons: [
            {
              extend: "copy",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "csv",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "excel",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "pdf",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "print",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
          ],
          lengthMenu: [5, 10, 25, 50, 75, 100],

          //"csv", "excel", "pdf", "print",
        });
      });

      $(document).ready(function () {
        $("#commodityTradingTable").DataTable({
          info: false,
          responsive: true,
          dom: "lfrtiBp",
          buttons: [
            {
              extend: "copy",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "csv",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "excel",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "pdf",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "print",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
          ],
          lengthMenu: [5, 10, 25, 50, 75, 100],

          //"csv", "excel", "pdf", "print",
        });
      });

      $(document).ready(function () {
        $("#fineTable").DataTable({
          info: false,
          responsive: true,
          dom: "lfrtiBp",
          buttons: [
            {
              extend: "copy",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "csv",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "excel",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "pdf",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "print",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
          ],
          lengthMenu: [5, 10, 25, 50, 75, 100],

          //"csv", "excel", "pdf", "print",
        });
      });

      $(document).ready(function () {
        $("#projectFinancingTable").DataTable({
          info: false,
          responsive: true,
          dom: "lfrtiBp",
          buttons: [
            {
              extend: "copy",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "csv",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "excel",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "pdf",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "print",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
          ],
          lengthMenu: [5, 10, 25, 50, 75, 100],

          //"csv", "excel", "pdf", "print",
        });
      });

      $(document).ready(function () {
        $("#totalContributionTable").DataTable({
          info: false,
          responsive: true,
          dom: "lfrtiBp",
          buttons: [
            {
              extend: "copy",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "csv",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "excel",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "pdf",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
            {
              extend: "print",
              messageTop: "guguiguguguiguigui",
              title: "My Account Statement",
            },
          ],
          lengthMenu: [5, 10, 25, 50, 75, 100],

          //"csv", "excel", "pdf", "print",
        });
      });
    </script>
  </body>
</html>
