<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
    rel="stylesheet"
    href="bootstrap-5.0.0-beta2-dist/css/bootstrap.css"
  />
  </head>
  <body>
    <!-- tran = req.query.valid;
  res.render("edittransaction", {
    id: tran._id,
    transactiontype: tran.transactiontype,
    account: tran.account,
    amount: tran.amount,
    narration: tran.narration,
    date: tran.date,
  }); -->

  <div style="padding: 10px;">
    <h2>Modify Transaction for <%=user %></h2>
    <h5>Transaction ID: <%=id %></h5>
    <h5>Transaction type: <%=transactiontype %></h5>
    <h5>Account: <%=account %></h5>
    <h5>Amount: <%=amount %></h5>
    <h5>Narration: <%=narration %></h5>
    <h5>Date: <%=date %></h4>
  </div>
   

    <hr />

    <form action="" method="post" id="updatetransaction">

 
    <div
      style="
        display: flex;
        justify-content: space-between;
        padding: 20px;
        flex-wrap: wrap;
      "
    >
      <div style="padding: 10px">
        <label for="ID">ID</label>
        <input type="text" name="id" value="<%=id %>" disabled id="id"/>
      </div>
      <div style="padding: 10px">
        <label for="ID">Transaction type</label>
        <!-- <input type="text" id="transactiontype" name="transactiontype" value="<%=transactiontype %>" /> -->
        <select
      id="transactiontype"
        >
       
          <% if(transactiontype == 'credit') {%>
            <option value="<%=transactiontype %>"><%=transactiontype %></option>
          <option value="debit">debit</option>
          <%} else{%>
            <option value="<%=transactiontype %>"><%=transactiontype %></option>
            <option value="credit">credit</option>
          
            <%}%>
        </select>
      </div>
      <div style="padding: 10px">
        <select
        id="account"
          >

            <option selected value="<%=account %>"><%=account %></option>
            <% if(account == 'sharecapital') {%>
           
              <option value="thriftsavings">thriftsavings</option>
              <option value="specialdeposit">specialdeposit</option>
              <option value="commoditytrading">commoditytrading</option>
              <option value="fine">fine</option>
              <option value="loan">loan</option>
              <option value="projectfinancing">projectfinancing</option>
              <%} else if(account== 'thriftsavings'){%>
                <option value="sharecapital">sharecapital</option>
          
                <option value="specialdeposit">specialdeposit</option>
                <option value="commoditytrading">commoditytrading</option>
                <option value="fine">fine</option>
                <option value="loan">loan</option>
                <option value="projectfinancing">projectfinancing</option>
              
                <%} else if(account== 'specialdeposit'){%>
                  <option value="sharecapital">sharecapital</option>
                  <option value="thriftsavings">thriftsavings</option>
               
                  <option value="commoditytrading">commoditytrading</option>
                  <option value="fine">fine</option>
                  <option value="loan">loan</option>
                  <option value="projectfinancing">projectfinancing</option>
                
                  <%} else if(account== 'commoditytrading'){%>
                    <option value="sharecapital">sharecapital</option>
                    <option value="thriftsavings">thriftsavings</option>
                    <option value="specialdeposit">specialdeposit</option>
                
                    <option value="fine">fine</option>
                    <option value="loan">loan</option>
                    <option value="projectfinancing">projectfinancing</option>
                  
                    <%}else if(account== 'fine'){%>
                      <option value="sharecapital">sharecapital</option>
                      <option value="thriftsavings">thriftsavings</option>
                      <option value="specialdeposit">specialdeposit</option>
                      <option value="commoditytrading">commoditytrading</option>
                
                      <option value="loan">loan</option>
                      <option value="projectfinancing">projectfinancing</option>
                    
                      <%}else if(account== 'loan'){%>
                        <option value="sharecapital">sharecapital</option>
                        <option value="thriftsavings">thriftsavings</option>
                        <option value="specialdeposit">specialdeposit</option>
                        <option value="commoditytrading">commoditytrading</option>
                        <option value="fine">fine</option>
                        <option value="projectfinancing">projectfinancing</option>
                      
                        <%}else{%>
                          <option value="sharecapital">sharecapital</option>
                          <option value="thriftsavings">thriftsavings</option>
                          <option value="specialdeposit">specialdeposit</option>
                          <option value="commoditytrading">commoditytrading</option>
                          <option value="fine">fine</option>
                          <option value="loan">loan</option>
                        
                          <%}%>
              
            
           
          </select>
        <!-- <label for="ID">Account</label>
        <input type="text" id="account" name="account" value="<%=account %>" disabled/> -->
      </div>
      

     
    
    
      
    </div>

    <div
      style="
        display: flex;
        justify-content: space-between;
        padding: 0px 20px 20px 20px;
        flex-wrap: wrap;
      "
    >
      <div style="padding: 10px">
        <label for="ID">Amount</label>
        <input type="number" value= "<%=amount %>" step=".01" min="0" id="amount" name="amount"  />
      </div>

      <div style="padding: 10px">
        <label for="ID">Narration</label>
        <input type="text" id="narration" name="narration" value="<%=narration %>" />
      </div>
      <div style="padding: 10px">
        <label for="ID">Date</label>
        <input type="date" id="date" name="date" value="<%=date %>" />
      </div>
    </div>

    <button>Update</button>
  </form>

    <div>
     
      <button id="deletetransaction" disabled>Delete</button>
      <button id="canceltransaction">Cancel</button>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="bootstrap-5.0.0-beta2-dist/js/bootstrap.bundle.js"></script>



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="bootstrap-5.0.0-beta2-dist/js/bootstrap.bundle.js"></script>

    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="datatables/jquery.js"></script>
    <script src="datatables/DataTables-1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="datatables/Buttons-1.6.5/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="datatables/Buttons-1.6.5/js/buttons.html5.min.js"></script>
    <script src="datatables/Buttons-1.6.5/js/buttons.print.min.js"></script>

    <script>
// location.replace("https://chadventmpcs.herokuapp.com/admin");
function sweetSuccess(message) {
        return Swal.fire({
          position: "center",
          icon: "success",
          title: message,
          showConfirmButton: false,
          timer: 3000,
        });
      }

      function sweetFailure(message) {
        return Swal.fire({
          position: "center",
          icon: "error",
          title: message,
          showConfirmButton: false,
          timer: 3000,
        });
      }

      var currentuser ="<%=user %>";



      $("#updatetransaction").submit(function (e) {
        e.preventDefault();
        Swal.fire({
          title: "Are you sure you want to update this transaction?",
          showDenyButton: true,
          confirmButtonText: `Yes`,
          denyButtonText: `No`,
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              url: "https://chadventmpcs.herokuapp.com/edittransaction",
              type: "POST",
              data: {
                actiontoperform: "update",
                // name: "suhfuhfdsuihdsifhdifdshoiusdigdugsdo",
                id: $('#id').val(),
                transactiontype: $('#transactiontype').val(),
                 account: $('#account').val(),
                amount: $('#amount').val(),
                narration: $('#narration').val(),
                date: $('#date').val(),
                user: currentuser
              },
              success: function (data) {

sweetSuccess("Transaction updated successfully")
                setTimeout(function () {
                  location.replace("https://chadventmpcs.herokuapp.com/edittransaction?valid=" + data)
            }, 2000);
           
           
                // if (data.message == "deleted successfully") {
                //   Swal.fire("Member Deleted", "", "success");

                //   location.replace("http://localhost:3000/admin");
                // }
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure("Transaction failed to update")
                console.log("Error");

              },
            });
          }else if (result.isDenied) {
            Swal.fire("This member has not been updated", "", "info");
          }});
      
          
        
      })
   
    $("#deletetransaction").click(function (e) {
      Swal.fire({
          title: "Are you sure you want to delete this transaction?",
          showDenyButton: true,
          confirmButtonText: `Yes`,
          denyButtonText: `No`,
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              url: "https://chadventmpcs.herokuapp.com/edittransaction",
              type: "POST",
              data: {
                actiontoperform: "delete",
                id: $('#id').val(),
                user: currentuser,
                transactiontype: $('#transactiontype').val(),
                 account: $('#account').val(),
                amount: $('#amount').val(),
                narration: $('#narration').val(),
                date: $('#date').val(),
              },
              success: function (data) {
                sweetSuccess("Transaction deleted successfully")
                console.log(data);
                setTimeout(function () {
                  location.replace("https://chadventmpcs.herokuapp.com/editmember?username=" + data.user )
            }, 2000);
              },

              fail: function (xhr, textStatus, errorThrown) {
                sweetFailure();
              },
            });
        
          }else if (result.isDenied) {
            Swal.fire("This transaction has not been deleted", "", "info");
          }});
      
      });


      $("#canceltransaction").click(function (e) {
        Swal.fire({
          title: "Cancel update?",
          showDenyButton: true,
          confirmButtonText: `Yes`,
          denyButtonText: `No`,
        }).then((result) => {
          if (result.isConfirmed) {
            location.replace("https://chadventmpcs.herokuapp.com/editmember?username=" + currentuser );
           
              }
             
        
          else if (result.isDenied) {
         
          }});
      
    
      
        
      });
   </script>
  </body>
</html>
